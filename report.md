## Java Tank

#### 项目信息

- 小组成员：高一鸣 李林豇 黄星童

- 项目名：Java Tank
- 项目简介：即时坦克对战游戏
- Github仓库地址：https://github.com/Metakar1/Java-IOTank

#### 使用说明

项目分为服务端与客户端

##### 服务端

直接运行即可，默认端口绑定7650

##### 客户端

###### 进入游戏

- 点击游戏，进入服务器选择、房间选择页面
- 确认信息无误后，点击OK进入角色选择界面
- 在角色界面左右滑动，选择合适的角色，点击OK进入游戏

###### 游戏操作

对于PC端

- 按W、A、S、D分别向上下左右移动
- 鼠标左键单机开火，消灭中立物和敌人会获得能量
- 能量条满后按Q发动技能

#### 项目架构

- 图形化框架：libGDX
- 项目构建管理：Gradle
- 版本控制：Github

###### 项目结构

```
GDX_Tank
├─ README.md
├─ android
│    ├─ AndroidManifest.xml
│    ├─ build.gradle
│    ├─ res
│    └─ src
├─ build.gradle
├─ core
│    ├─ assets
│    ├─ build
│    ├─ build.gradle
│    └─ src
├─ desktop
│    ├─ build
│    ├─ build.gradle
│    └─ src
├─ gradle
│    └─ wrapper
├─ gradle.properties
├─ gradlew
├─ gradlew.bat
├─ out
└─ settings.gradle

```

#### 项目特色

- 即时多人对战游戏：TCP、锁定同步
- 跨平台：支持Windows、Mac、Linux、Android
- 丰富游戏性：数种不同角色，拥有独特属性与技能
- 美术设计：精心挑选丰富多样的音乐与图片，配以简洁的渲染贴图

##### TCP

- TCP是一种可靠的通信方式，能够保证接受数据的完整性与顺序

- 选择TCP便可以不操心网络波动，虽然通常相比UDP会带来性能损失

##### 锁定同步

- 以帧作为单位，同步每帧的变化量，即客户端的操作

- 客户端将操作发给服务端，服务端汇总每一帧的操作，并分发给客户端
- 客户端使用当前帧的变化量以及上一帧的操作计算下一帧
- 节约了服务器的计算资源与流量

##### 跨平台

支持Windows、Mac、Linux、Android多个操作系统

- Android中特别增加了屏幕摇杆并做了界面适配。屏幕摇杆用以代替键盘，界面适配用以适配手机较小的屏幕尺寸

##### 游戏性

三种不同类别的坦克，每种坦克有不同的特点

- 坦克A：体积大、血量厚、射程远、发射小而密的霰弹
- 坦克B：体积小、移速快、射程长、发射长间隔得狙击弹
- 坦克C：各方面平均

同时每种坦克有不同的技能

- 向周围发射大而缓慢得子弹
- 获得隐身能力
- 射速变快、伤害变高

##### 美术设计

- 精心挑选了数张插图，对应不同坦克，来自Pixiv
- 甄选了三首符合坦克属性得BGM，来自少女与战车得OST
- 同时自己使用像素画板（LibGDX Pixmap）绘制了数个美观简洁的贴图
- 素材整体上围绕少女与战车展开

#### 项目鸟瞰

- 为防止消息堵塞，每个客户端会与服务器建立两个Socket，一个收一个发

##### 通信封装

`org.gyming.tank.connection`

封装了有关服务端与客户端间通信各种操作，大致如下

- MsgIO：封装了消息收发，包含一个socket与该socket对应的input/OutputStream，实现了send、receive方法
- User：一个User类代表一个用户，类中包含两个socket，一个负责收，一个负责发
- GameAction：代表来自某个用户的某个操作
- GameFrame：一些列GameAction的合集，往往代表一帧中发生的所有的操作
- GameMsg：在游戏中客户端与服务端的通信应以该类为模板，其中包含用户信息与操作信息
- ConnectMsg：用户在连接游戏时与服务端的通信模板，包括用户信息与加入的房间信息

##### 服务端

`org.gyming.tank.server`

###### 技术特点

- 使用全局线程池，确保服务器可用
- 大量使用队列代替加锁，因为队列先进先出，可以同时读取、加入

###### 文件详解

- Server.java：绑定端口号，服务器开始监听
- UserManager：管理用户的类。客户端与服务端连接后会发送用户信息，UserManager会收集用户信息，将同一个用户的两个Socket集中在一起
- RoomManager：管理所有房间的类，用HashMap存储。客户端在想加入房间时，该类会检查是否已经存在房间。是则加入，否则新建房间
- Room：单个房间的类，用队列维护所有客户端。使用计时器每次收集客户端的所有消息，并分发给所有客户端
- Client：一个用户的类，包含了两个队列，分别是该用户上传的操作与等待下发给该用户的操作。由两个Runnable类构成
- ParseConnectAction：用以解析用户连接服务器后的操作，当前只实现了join，即加入房间

##### 客户端

